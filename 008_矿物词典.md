# 008 矿物词典

在一个合成表中。如果有多种备选材料该怎么办呢？

如果情况比较简单，你可以把所有可能的情况都写出来。

但是如果情况很复杂，比如原版的石英台阶合成。需要的六个石英块可以是石英块，錾制石英块，竖纹石英块中的任何一种，也可以是它们的混合。一个一个把可能的组合排列全写出来显然不是一个明知的方法。

## 一个占位符代表多种物品

还记得我们写`key`的时候，如何定义占位符么？

就像这样`"s":{"item":"minecraft:cobblestone_stairs"}`。其中`s`是占位符，后边的是所对应的物品id。请注意，`s`不仅仅可以是一个json对象，也可以是一个数组，包含多个物品id。看一下原版配方给我们做出的示范：

```json
{
  "type": "crafting_shaped",
  "pattern": [
    "#  ",
    "## ",
    "###"
  ],
  "key": {
    "#": [
      {
        "item": "minecraft:chiseled_quartz_block"
      },
      {
        "item": "minecraft:quartz_block"
      },
      {
        "item": "minecraft:quartz_pillar"
      }
    ]
  },
  "result": {
    "item": "minecraft:quartz_stairs",
    "count": 8
  }
}
```

这样写就表明`pattern`中的任何一个`#`都可以用三种石英块中的任意一种替换。

## 不足之处

用一个占位符代表多种物品仍然有其不足和不方便的地方。如果备选的材料种类非常多，而且使用到的配方也非常多，那么在每个配方中都把可能的材料列表写一遍显然很不划算。

数据包中的tag就解决了这个问题。

## 关于标签

首先tag是和配方，战利品表同级的一种数据包资源。需要放在命名空间下的`tags`文件夹。

在`tags`文件夹下还需要新建三个文件夹`blocks`,`items`,`functions`。分别用于放置方块标签，物品标签和函数标签。

标签文件的格式详见<https://minecraft.gamepedia.com/Tag>

标签文件名就是标签的名称。标签就相当于命名数组。在标签文件中列举的所有物品，方块或者函数名会是这个数组的成员。在配方函数或者别的什么地方调用标签，就相当于调用了标签中所有的成员。

举个原版的例子。原版每种树木有四种原木（自然生成的，刨去树皮的，六面全是树皮的，打磨过的刨皮的）。四种原木都能合成对应种类的木板。而且这四种原木在任何一个用到原木的地方都应该是等价的。

原版用了标签来处理这四种原木涉及的合成。这是原版的`acacia_logs.json`。（属于`tags/blocks`）

```json
{
  "replace": false,
  "values": [
    "minecraft:acacia_log",
    "minecraft:acacia_wood",
    "minecraft:stripped_acacia_log",
    "minecraft:stripped_acacia_wood"
  ]
}
```

这是原版的`acacia_planks.json`配方（属于`recipes`）

```json
{
  "type": "crafting_shapeless",
  "group": "planks",
  "ingredients": [
    {
      "tag": "minecraft:acacia_logs"
    }
  ],
  "result": {
    "item": "minecraft:acacia_planks",
    "count": 4
  }
}
```

可以看到在定义了标签后，合成表中没有使用物品或者方块id，而是使用了标签名用来表示材料。

## 标签的注意事项

1. 标签本身是多个元素的集合。所以标集不能作为合成的输出（否则违反函数多对一的性质）。
1. 放到同一个标签之下的东西必须是同类。不能把方块和物品，方块和函数，或者函数和物品放到同一个标签之下。而且必须把标签放到对应的文件夹之下。比如物品标签必须放到`tags/items`文件夹下。
1. 原版的`minecraft`命名空间下有一个特殊的标签类别名叫`fluids`。和原版中一些机制有关。详见<https://minecraft.gamepedia.com/Tag>。
1. 除了用于配方。函数也可以使用标签。不过那就是函数部分的内容了。

## 其他

不管是用一个占位符表示多种物品还是用标签，写出来的配方都算是一个。在合成书中也只会占一格显示。

有序合成，无序合成，熔炉这三种配方的输入都可以用标签替代物品id（或者方块id）。

## 矿物词典的故事

这一期的标题是“矿物词典”可是却没有介绍“矿物词典”。因为“矿物词典”根本不是一个Minecraft数据包中的概念。

矿物词典是很久以前，我的世界非官方mod接口forge为了解决本期所讨论的问题而设置的一个机制。用法什么的和这里的物品标签，方块标签类似（但是不涉及Minecraft函数系统，因为那时候Minecraft还没有`function`这个命令）。

对于Minecraft来说来自玩家的才智，创意和付出极大地增强了游戏的生命力。但是其中的佼佼者forge等项目却一直受到非官方身份的困扰。

虽然官方一直在~~通过吞mod的方式~~与mod界进行互动。但是之前的成果并不是很明显。一直以来没有官方支持的强有力的mod接口是我的世界mod发展的一个非常严重的制约因素。我认为这次推出的数据包机制应该算是官方的一次非常有价值的尝试。希望数据包能走得更远一些，真正成为一个功能强大的mod接口。
